# 《JavaScript 高级程序设计》第十三章：事件

## 简介

JavaScript 与 HTML 的交互是通过“事件”实现的，它相当于两者的枢纽，建立链接关系。

“事件”是文档或浏览器窗口发生的特定交互场景，我们可以使用侦听器(Linstener)来预定事件，以便对应的交互场景发生后执行相应的代码。而这种实现模式在软件工程中被称之为“观察员模式”

“事件”最早出现与 `IE3`, `NetSapce Navigator 2`中，在 `IE4` 与 `NN4` 时开始趋于相似，但直到 DOM2 级的事件模块才开始将其标准化为 DOM 事件。目前位置 IE9+版本已经完全实现了 DOM 事件核心。

浏览器的事件系统除了 DOM 事件，还有 BOM 事件，但是由于 BOM 一直缺乏标准规范，所以经常会跟 DOM 的事件的区分并不十分清晰。

## 事件流

事件流描述的是事件被触发后在文档中的传播与接收的顺序，其中 IE 浏览器提出了“事件冒泡流”，NetSapce 则提出了“事件捕获流”，它们完全是相反的概念

### 冒泡事件流

事件冒泡(bubbling)是 IE 提出的事件流。即事件从触发事件的目标元素起沿着 DOM 树层层向上传播至 window 为止，也就是说再此之间的元素都可以接收触发的事件。
示例图：

### 捕获事件流

事件捕获(capturing)是 NetSpace 团队提出的。其思想是事件的触发由最顶层的元素开始接收，然后再沿着 DOM 树层层传播至实际触发的目标元素为止。
示例图：

### DOM 事件流

DOM 事件流就是标准事件流，它有三阶段：“捕获阶段”、“目标阶段”、“冒泡阶段”。

- 捕获阶段：当一个事件被触发后，就会由 window 发出，然后沿着 DOM 树不断的层层向下传递，一直传递到目标元素的父元素为止，这一过程就是“捕获阶段”。在这个捕获的过程中，所有经过的节点都会触发这个事件，捕获阶段的任务就是建立事件传递的路线，以后之后的冒泡阶段顺着这条路线返回至 window。由于捕获阶段不会将事件传递到“目标元素”上，所以理论上按照标准规定，事件捕获阶段不会触发目标阶段的事件处理程序。
- 目标阶段：当事件捕获阶段传递完毕后，下一个要传递的事件接收节点便是实际触发元素的目标节点，因此从目标阶段就是从捕获阶段传递到实际的目标元素的过程，目标阶段会触发目标节点的事件处理程序。如果在这一阶段指定了不冒泡，那就会在这里中止.
- 冒泡阶段：目标阶段完成后，事件便会从目标元素的父元素开始沿着捕获阶段的路线以相反的方向从下向上返回最顶层的 window 对象，这一过程就是冒泡阶段，可以看作是捕获阶段的逆传播，因此在事件传播过程中的 DOM 节点理论上都可以触发两次事件，一次是捕获阶段，另一次是在冒泡阶段。但现实情况却不会发生，原因在与 DOM0 级的事件句柄只支持捕获，而 DOM2 级的事件监听器只能在捕获与冒泡两种阶段二选一。
